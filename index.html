<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Rails BDD test practices by bunniesandbeatings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Rails BDD test practices</h1>
      <h2 class="project-tagline">Notes about testing practices</h2>
      <a href="https://github.com/bunniesandbeatings/bdd" class="btn">View on GitHub</a>
      <a href="https://github.com/bunniesandbeatings/bdd/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/bunniesandbeatings/bdd/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>

<h1>
<a id="feature-tests-in-rails" class="anchor" href="#feature-tests-in-rails" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Feature Tests in Rails</h1>

<h2>
<a id="tools" class="anchor" href="#tools" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tools</h2>

<ul>
<li>Use SimpleBDD

<ul>
<li> Cucumber leads to 'early dried' tests</li>
<li> Cucumber leads to conditionals in step definitions</li>
<li> Devs have an unhealthy focus on making step definitions reusable.</li>
</ul>
</li>
</ul>

<h1>
<a id="wet-vs-dry" class="anchor" href="#wet-vs-dry" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Wet vs. DRY</h1>

<p>Test's should not be very dry. <em>WET</em> tests allow you to continually learn about your system, and understand the impact of feature changes.</p>

<p>For example. </p>

<ol>
<li>You have eight tests that describe the user registration process.</li>
<li>The progression through the process is dried up in Step Definitions or a helper.</li>
<li>You change conditional to show a confirmation dialog and edit the test helper to match.</li>
<li>You miss the fact that in one of the other tests, the user should still see the dialog. </li>
</ol>

<p>The problem is hidden because the test helper provided no context about the different scenarios.</p>

<p>Some <em>DRY</em> guidelines:</p>

<ul>
<li>Carefully DRY <strong>backgrounds and stubs</strong>

<ul>
<li>Stubs often need to change because of the test</li>
<li>Once DRYed stubs are harder to rework</li>
<li>This is true of Factories too</li>
<li>If you do use DRY tools for backgrounds, make sure they're flexible (IE. FactoryGirl)</li>
</ul>
</li>
<li>Carefully DRY Givens

<ul>
<li>Make sure that the state in a given is 'wet' tested. E.g. If the given is 'a user is logged in' there must also be a 'User logs in' Feature.</li>
<li>Same rule applies as backgrounds and stubs</li>
</ul>
</li>
<li>Don't dry up behaviours (When)

<ul>
<li>These are the actions you care about. Don't hide the cause away with indirection!</li>
<li>Except:

<ul>
<li>code to drive the system, IE Capybara.</li>
</ul>
</li>
</ul>
</li>
<li>Don't dry up expectations (Then)</li>
</ul>

<h2>
<a id="feature-files" class="anchor" href="#feature-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Feature files</h2>

<ul>
<li>Write the shortest possible features about the story you implement.</li>
<li>If all your stories 'travel' through your system

<ul>
<li>They will be slow</li>
<li>They will not be focused on the <em>stand-out</em> aspects of the feature</li>
<li>They will get cumbersome and you'll be inclined to dry up, and thus hide, important details.</li>
<li>Tests that rely on a significant proportion of 'travel' will not stand out. If all tests travel, then it's hard to know when a certain must travel.</li>
</ul>
</li>
</ul>

<p>Instead, establish a background at the start of test and mitigate the risk that the whole story is not played out by:</p>

<ul>
<li>Use a smoke test for important paths through the system</li>
<li>Make sure you have a travelling test for your background.<br>
</li>
</ul>

<p>For example, the following test is focused on the action of getting the "widget app".</p>

<pre><code>Feature: 'Downloading our awesome widget app'
Given John is logged in
When he visits the download page
And he downloads the widget app
Then he has our awesome widget app 
</code></pre>

<p>There is no evidence that he can register and log in to do so. That's ok, so long as a test exists for <code>A user registers with the site</code> and <code>A registered user can log in</code>.</p>

<p>It is possible that between <code>Register</code> and <code>Login</code> and between <code>Login</code> and <code>Download</code> that something could change and invalidate a test. Perhaps the download link no longer appears on the page you see after login. This is where you do need <strong>travelling</strong> tests.</p>

<h2>
<a id="smoke-and-travelling-tests" class="anchor" href="#smoke-and-travelling-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Smoke and travelling tests</h2>

<ul>
<li>Write long 'travelling tests' about the important aspects of the application.

<ul>
<li>Try and run these against production 

<ul>
<li>Actual live site if you have a single important instance</li>
<li>Clones or emulations of likely production environments if users install your software.</li>
</ul>
</li>
<li>Also run them before committing your code to your main branch.</li>
</ul>
</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/bunniesandbeatings/bdd">Rails BDD test practices</a> is maintained by <a href="https://github.com/bunniesandbeatings">bunniesandbeatings</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
